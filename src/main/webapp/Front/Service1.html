<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Nouveau Film</title>
    <link rel="stylesheet" type="text/css" href="styles.css">

</head>

<body>
    <nav class="navbar">
        <button onclick="window.location.href='Service1'">Premier Service</button>
        <button onclick="window.location.href='Service2'">Deuxième Service</button>
        <button onclick="window.location.href='Service3'">Troisième Service</button>
    </nav>
    <div id="content">
        <div id="leftSidebar">
            <!-- Contenu de la barre latérale gauche ici -->
        </div>
        <div id="mainContent">

            <h1>Publier un nouveau film</h1>
            <form id="filmForm" >
                <label for="title">Titre:</label><br>
                <input type="text" id="title" name="title"><br>
                <label for="duration">Durée:</label><br>
                <input type="text" id="duration" name="duration"><br>
                <label for="language">Langue:</label><br>
                <input type="text" id="language" name="language"><br>
                <label for="subtitles">Sous-titres:</label><br>
                <input type="text" id="subtitles" name="subtitles"><br>
                <label for="director">Réalisateur:</label><br>
                <input type="text" id="director" name="director"><br>
                <label for="mainActors">Acteurs Principaux:</label><br>
                <input type="text" id="mainActors" name="mainActors"><br>
                <label for="minAge">Âge Minimum Requis:</label><br>
                <input type="text" id="minAge" name="minAge"><br>
                <label for="startDate">Date de Début:</label><br>
                <input type="date" id="startDate" name="startDate"><br>
                <label for="showTime">Horaire de Début:</label><br>
                <input type="time" id="showTime" name="showTime"><br>
                <label for="city">Ville:</label><br>
                <input type="text" id="city" name="city"><br>
                <label for="cinemaAddress">Adresse du Cinéma:</label><br>
                <input type="text" id="cinemaAddress" name="cinemaAddress"><br>
                <input type="submit" value="Soumettre">
            </form>
        </div>
        <div id="all_movie"></div>

        <div id="rightSidebar">
            <!-- Contenu de la barre latérale droite ici -->
        </div>

    </div>
    <script>
        document.getElementById('filmForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            let releaseDate = document.getElementById('startDate').value;
            let startTime = document.getElementById('showTime').value;
            let combinedDateTime = `${releaseDate}T${startTime}`;

            let newFilm = {
                "id": 0,
                "title": document.getElementById('title').value,
                "duration": parseInt(document.getElementById('duration').value),
                "language": document.getElementById('language').value,
                "subtitlesLanguages": [document.getElementById('subtitles').value],
                "director": document.getElementById('director').value,
                "mainActors": [document.getElementById('mainActors').value],
                "minimalAge": parseInt(document.getElementById('minAge').value),
                "releaseDate": document.getElementById('startDate').value,
                "sessions": [{
                    "startTime": combinedDateTime,
                    "cinemaName": document.getElementById('cinemaAddress').value,
                    "city": document.getElementById('city').value
                }]
            };

            console.log(JSON.stringify(newFilm));
            try {
                let response = await fetch(`http://localhost:8080/ALLOCINE_API_war_exploded/api/Service1`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newFilm)
                });

                if (response.ok) {
                    console.log('Film soumis avec succès!');
                } else {
                    console.log('Une erreur 1 s\'est produite lors de la soumission du film');
                }
            } catch (error) {
                console.error('Erreur:', error);
                console.log('Une erreur 2 s\'est produite lors de la soumission du film');
            }
        });

    </script>
    <script>
        // Fonction asynchrone pour récupérer les films
        async function fetchMovies() {
            // Envoyer une requête GET à l'API pour récupérer les films
            let response = await fetch('http://localhost:8080/ALLOCINE_API_war_exploded/api/allmovie');

            // Si la réponse est OK, alors on la transforme en JSON
            if (response.ok) {
                let movies = await response.json();

                // Vérifie si des films ont été renvoyés
                if (movies.length > 0) {
                    // Sélectionner l'élément du DOM où l'on souhaite afficher les films
                    let allMovieElement = document.getElementById('all_movie');

                    // Créer et ajouter le titre h2
                    let titleElement = document.createElement('h2');
                    titleElement.textContent = 'Liste des films dans la base';
                    allMovieElement.appendChild(titleElement);

                    // Créer et ajouter la liste de films
                    let movieList = document.createElement('ul');
                    allMovieElement.appendChild(movieList);

                    // Parcourir chaque film dans la réponse
                    for (let movie of movies) {
                        // Créer un élément li pour chaque film
                        let movieElement = document.createElement('li');

                        // Format the date
                        let date = new Date(movie.releaseDate);
                        let formattedDate = date.getDate() + "-" + (date.getMonth() + 1) + "-" + date.getFullYear();

                        // Mettre les détails du film dans l'élément li
                        movieElement.textContent = `Titre: ${movie.title}, Réalisateur: ${movie.director}, Date de sortie: ${formattedDate}`;

                        // Ajouter l'élément li à la liste de films
                        movieList.appendChild(movieElement);
                    }
                }
            } else {
                console.log('Erreur de la requête HTTP:', response.status);
            }
        }

        // Appeler la fonction fetchMovies lorsque la page est chargée
        window.onload = fetchMovies;
    </script>


</body>

</html>